{% extends "libs/base.html" %}
{% load staticfiles %}
{% block container %}
<div class="am-container am-padding-sm">
    <div class="am-tabs">
        <ul class="am-tabs-nav am-nav am-nav-tabs am-nav-justify">
            <li {% if tabstatus == 'all' %}class="am-active"{% endif %}><a href="/order/?tabstatus=all">全部</a></li>
            <li {% if tabstatus == 'used' %}class="am-active"{% endif %}><a href="/order/?tabstatus=used">已使用</a></li>
            <li {% if tabstatus == 'unuse' %}class="am-active"{% endif %}><a href="/order/?tabstatus=unuse">未使用</a></li>
        </ul>
        <div class="am-tabs-bd">
            <div class="am-tab-panel am-active">
            {% for order in order_list %}  
                {% for product in order.products_in_all %}
                    <div class="order-box am-padding-xs am-margin-xs">
                        <div class="am-g">
                            <div class="am-u-sm-12">
                                <p class="am-text-xs am-margin-xs">订单号：{{order.order_txt}}</p>
                            </div>
                        </div>
                        <div class="am-g">
                            <div class="am-u-sm-4">
                                <img src="{{product.product.cover}}" class="am-img-thumbnail product_img" />
                            </div>
                            <div class="am-u-sm-8">
                                {{product.product.name}} * {{product.count}}<br/>
                                <small class="am-text-danger">¥{{product.price}}</small>
                                {% if order.status == 3 %}
                                    {% if product.status == 1 %}
                                    <a class="am-btn am-btn-default am-btn-xs am-fr" disabled="disabled">已消费</a>
                                    {% else %}
                                    <a class="am-btn am-btn-beauty am-btn-xs am-fr" href="tel:075729292933">电话预约</a>
                                    {% endif %}
                                {% elif order.status != 4 %}
                                    <a class="am-btn am-btn-danger am-btn-xs am-fr" href="{% url 'shopcart_order_checkout' %}?order_id={{order.id}}">付款</a>
                                    <a class="am-btn am-btn-warning am-btn-xs am-fr" href="javascript:void(0)" to="{% url 'order_operation' %}?operation=delete&order_id={{order.id}}" id="canel-order">取消</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% endfor %}
            </div> 
        </div>
    </div>
</div>
<div class="am-modal am-modal-confirm" tabindex="-1" id="myconfirm">
  <div class="am-modal-dialog">
    <div class="am-modal-hd">提醒</div>
    <div class="am-modal-bd">
      您确定要取消该订单吗？
    </div>
    <div class="am-modal-footer">
      <span class="am-modal-btn" data-am-modal-cancel>否</span>
      <span class="am-modal-btn" data-am-modal-confirm>是</span>
    </div>
  </div>
</div>
{% endblock %}
{% block script %}
<script>
$(function(){
    $('#canel-order').click(function(){
        $('#myconfirm').modal({
            relatedTarget: this,
            onConfirm: function(options) {
              window location.href = $(this.relatedTarget).attr('to');
            },
      });
    });
});
</script>
{% endblock %}